from sqlalchemy.orm import Session

from app.models.admin_user import AdminUser
from app.models.company import Company
from app.models.qa_knowledge import QaKnowledge
from app.services.auth_service import hash_password


def seed_data(db: Session):
    # --- Seed companies ---
    if db.query(Company).count() == 0:
        default_company = Company(
            company_name="세종푸르지오시티 2차",
            business_number="000-00-00000",
            industry="일반",
            subscription_plan="enterprise",
            max_qa_count=1000,
            max_admins=50,
            is_active=True,
        )
        demo_company = Company(
            company_name="세종더리치 호수의 아침",
            business_number="111-11-11111",
            industry="IT",
            subscription_plan="free",
            max_qa_count=50,
            max_admins=3,
            is_active=True,
        )
        db.add(default_company)
        db.add(demo_company)
        db.commit()

    # --- Seed admin users ---
    if db.query(AdminUser).count() == 0:
        # Super admin (company_id=0: access all companies)
        admin = AdminUser(
            company_id=0,
            username="admin",
            password_hash=hash_password("admin123"),
            email="admin@example.com",
            full_name="시스템 관리자",
            role="super_admin",
            is_active=True,
        )
        db.add(admin)

        # Demo company admin
        demo_admin = AdminUser(
            company_id=2,
            username="demo_admin",
            password_hash=hash_password("demo123"),
            email="admin@demo.com",
            full_name="데모 관리자",
            role="admin",
            is_active=True,
        )
        db.add(demo_admin)

        db.commit()

    # --- Seed QA for default company (company_id=1) ---
    if db.query(QaKnowledge).filter(QaKnowledge.company_id == 1).count() == 0:
        qa_entries = [
            # 이주정산 - 8 entries
            {
                "category": "이주정산",
                "question": "이주정산이란 무엇인가요?",
                "answer": "이주정산은 아파트·오피스텔 입주자가 퇴거(이사)할 때 보증금, 관리비, 공과금 등을 최종 정산하는 절차입니다. 임대차 계약 종료 시 미납 관리비·공과금을 공제한 뒤 보증금을 반환하며, 시설물 훼손이 있으면 원상복구 비용도 정산 대상입니다.",
                "keywords": "이주정산,퇴거,이사,보증금,정산,원상복구",
            },
            {
                "category": "이주정산",
                "question": "이주정산 절차는 어떻게 되나요?",
                "answer": "이주정산 절차: 1)퇴거일 확정 및 관리사무소 사전 통보, 2)퇴거일 기준 관리비·공과금 정산(검침 포함), 3)시설물 점검 및 하자 확인, 4)미납금 공제 후 보증금 반환 금액 확정, 5)보증금 반환(통상 퇴거일로부터 1개월 이내). 퇴거 최소 1개월 전에 관리사무소에 통보하는 것이 좋습니다.",
                "keywords": "이주정산,절차,퇴거,통보,보증금반환,시설점검",
            },
            {
                "category": "이주정산",
                "question": "이주정산 시 정산 항목은 무엇인가요?",
                "answer": "이주정산 주요 항목: 1)미납 관리비, 2)수도·전기·가스 사용료(퇴거일 기준 검침), 3)주차비, 4)장기수선충당금 정산(해당 시), 5)시설물 훼손·파손 원상복구 비용, 6)도배·청소 비용(계약 조건에 따라), 7)기타 미납 부과금. 공과금은 퇴거 당일 검침 기준으로 일할 계산합니다.",
                "keywords": "이주정산,항목,관리비,수도,전기,가스,원상복구,도배",
            },
            {
                "category": "이주정산",
                "question": "보증금 반환은 언제 되나요?",
                "answer": "보증금은 통상 퇴거 완료 후 1개월 이내에 반환됩니다. 임대차보호법상 임대인은 임차인이 퇴거한 날로부터 보증금을 반환할 의무가 있으며, 미납 관리비·공과금·원상복구 비용을 공제한 잔액을 돌려받게 됩니다. 정산 내역서를 반드시 확인하세요.",
                "keywords": "보증금,반환,기간,임대차보호법,공제,정산내역서",
            },
            {
                "category": "이주정산",
                "question": "이주정산 시 관리비는 어떻게 정산하나요?",
                "answer": "퇴거월 관리비는 일할 계산합니다. 예를 들어 15일에 퇴거하면 해당 월 관리비의 15/30(또는 해당 월 일수)만 부담합니다. 공용관리비(일반관리비, 청소비, 경비비, 승강기 유지비 등)는 일할 계산하고, 개별사용료(수도, 전기, 가스, 난방)는 퇴거일 검침 기준으로 정산합니다.",
                "keywords": "이주정산,관리비,일할계산,공용관리비,개별사용료,검침",
            },
            {
                "category": "이주정산",
                "question": "퇴거 시 도시가스·전기·수도 정산은 어떻게 하나요?",
                "answer": "퇴거일에 관리사무소 또는 해당 공급기관에서 계량기를 검침합니다. 수도: 관리사무소에서 검침 후 일할 정산. 전기: 한전에 이사정산 신청(☎123) 또는 관리사무소 통해 정산. 도시가스: 도시가스 회사에 이사정산 신청, 퇴거 당일 밸브 차단. 각 공과금은 최종 검침일 기준으로 계산되어 보증금에서 공제됩니다.",
                "keywords": "도시가스,전기,수도,검침,이사정산,공과금,한전",
            },
            {
                "category": "이주정산",
                "question": "시설물 훼손 시 비용은 누가 부담하나요?",
                "answer": "입주자 과실로 인한 시설물 훼손·파손은 입주자가 원상복구 비용을 부담합니다. 자연 마모·노후화에 의한 것은 임대인(소유자) 부담입니다. 퇴거 시 관리사무소 직원과 함께 시설물 점검을 진행하며, 벽지 오염, 바닥 긁힘, 설비 파손 등이 주요 확인 항목입니다. 분쟁 예방을 위해 입주 시 사진을 찍어두는 것이 좋습니다.",
                "keywords": "시설물,훼손,파손,원상복구,자연마모,입주자부담,시설점검",
            },
            {
                "category": "이주정산",
                "question": "이주정산 서류는 무엇이 필요한가요?",
                "answer": "이주정산 시 필요한 서류: 1)임대차계약서 사본, 2)신분증, 3)보증금 입금 통장 사본, 4)퇴거 신고서(관리사무소 양식), 5)시설물 인수인계서. 관리사무소에서 정산내역서를 발급받아 미납 내역과 공제 금액을 반드시 확인하세요.",
                "keywords": "이주정산,서류,임대차계약서,퇴거신고서,정산내역서,시설물인수인계",
            },
            # 관리비 - 7 entries
            {
                "category": "관리비",
                "question": "관리비에 포함되는 항목은 무엇인가요?",
                "answer": "관리비는 크게 공용관리비와 개별사용료로 나뉩니다. 공용관리비: 일반관리비, 청소비, 경비비, 소독비, 승강기 유지비, 수선유지비, 위탁관리수수료 등. 개별사용료: 수도료, 전기료, 가스(난방)비, 온수비, 정화조 사용료 등. 이 외에 장기수선충당금, 주차비 등이 별도 부과될 수 있습니다.",
                "keywords": "관리비,항목,공용관리비,개별사용료,일반관리비,청소비,경비비,승강기",
            },
            {
                "category": "관리비",
                "question": "관리비 납부 방법과 기한은 어떻게 되나요?",
                "answer": "관리비는 매월 고지서가 발행되며, 납부 기한은 보통 매월 말일까지입니다. 납부 방법: 1)자동이체(은행 계좌), 2)가상계좌 입금, 3)신용카드 납부(단지별 상이), 4)관리사무소 직접 납부. 자동이체를 설정하면 납부 누락을 방지할 수 있습니다. 고지서는 우편 또는 아파트 앱으로 확인 가능합니다.",
                "keywords": "관리비,납부,방법,기한,자동이체,가상계좌,고지서",
            },
            {
                "category": "관리비",
                "question": "관리비 연체 시 어떻게 되나요?",
                "answer": "관리비를 연체하면 연체료(가산금)가 부과됩니다. 일반적으로 납부기한 경과 후 월 1~3%의 연체이자가 발생합니다. 장기 연체(보통 3개월 이상) 시 관리규약에 따라 단수(수도), 주차 제한, 공용시설 이용 제한 등의 조치가 취해질 수 있습니다. 연체 관리비는 소멸시효가 5년이며, 법적 추심 대상이 될 수 있습니다.",
                "keywords": "관리비,연체,연체료,가산금,단수,주차제한,소멸시효",
            },
            {
                "category": "관리비",
                "question": "장기수선충당금이란 무엇인가요?",
                "answer": "장기수선충당금은 아파트의 주요 시설(지붕, 외벽, 승강기, 배관, 도로 등)을 장기적으로 보수·교체하기 위해 매월 적립하는 금액입니다. 공동주택관리법에 따라 의무 적립되며, 관리비와 함께 부과됩니다. 소유자 부담이 원칙이며, 임차인이 납부한 경우 퇴거 시 돌려받을 수 있습니다.",
                "keywords": "장기수선충당금,적립,시설보수,교체,승강기,배관,소유자부담",
            },
            {
                "category": "관리비",
                "question": "관리비 내역은 어디서 확인할 수 있나요?",
                "answer": "관리비 내역 확인 방법: 1)매월 발행되는 관리비 고지서(우편/앱), 2)아파트 관리 앱(아파트아이, 통합관리 앱 등), 3)관리사무소 방문 또는 전화 문의, 4)K-apt 공동주택관리 정보시스템(k-apt.go.kr)에서 단지별 관리비 공개 내역 확인. 항목별 전월 대비 증감도 확인할 수 있습니다.",
                "keywords": "관리비,확인,조회,고지서,아파트앱,K-apt,공동주택관리",
            },
            {
                "category": "관리비",
                "question": "관리비 이의 신청은 어떻게 하나요?",
                "answer": "관리비에 이의가 있으면: 1)관리사무소에 서면 또는 구두로 이의 제기, 2)입주자대표회의에 민원 접수, 3)지자체(시·군·구청) 공동주택 담당부서에 민원 신청, 4)한국토지주택공사(LH) 또는 공동주택관리 분쟁조정위원회에 조정 신청. 관리비 산출 근거와 증빙 자료를 요청할 권리가 있습니다.",
                "keywords": "관리비,이의,신청,민원,입주자대표회의,분쟁조정,증빙",
            },
            {
                "category": "관리비",
                "question": "공용관리비와 개별사용료의 차이는 무엇인가요?",
                "answer": "공용관리비는 단지 전체 공용부분의 유지·관리에 들어가는 비용으로, 세대별 면적 비율로 균등 배분됩니다(일반관리비, 청소비, 경비비, 승강기유지비 등). 개별사용료는 각 세대가 실제 사용한 만큼 부과되는 비용입니다(수도, 전기, 가스, 난방 등). 개별사용료는 계량기 검침 기준으로 산정됩니다.",
                "keywords": "공용관리비,개별사용료,차이,면적비율,균등배분,계량기,검침",
            },
            # 회계처리 (Accounting) - 5 entries
            {
                "category": "회계처리",
                "question": "아파트 관리비 회계처리는 어떻게 하나요?",
                "answer": "아파트 관리비 회계처리는 관리비 수입(부과액)과 지출(집행액)을 구분하여 기록합니다. 수입: 관리비 부과, 잡수입, 이자수입 등. 지출: 인건비, 청소용역비, 수선유지비, 보험료, 소모품비 등. 매월 관리비 부과·수납 대사를 실시하고, 미수금을 관리합니다. 공동주택회계처리기준에 따라 회계 장부를 작성해야 합니다.",
                "keywords": "관리비,회계처리,수입,지출,부과,수납,미수금,공동주택회계",
            },
            {
                "category": "회계처리",
                "question": "장기수선충당금 회계처리는 어떻게 하나요?",
                "answer": "장기수선충당금은 별도 계정으로 적립·관리합니다. 매월 부과 시 '장기수선충당금 예수금'으로 적립하고, 장기수선계획에 따른 공사 집행 시 지출 처리합니다. 장기수선충당금은 관리비와 별도 통장에서 관리해야 하며, 사용 시 입주자대표회의 의결이 필요합니다.",
                "keywords": "장기수선충당금,회계처리,적립,예수금,별도통장,입주자대표회의",
            },
            {
                "category": "회계처리",
                "question": "관리비 결산은 어떻게 하나요?",
                "answer": "관리비 결산은 매 회계연도 종료 후 2개월 이내에 실시합니다. 결산 절차: 1)수입·지출 총괄표 작성, 2)항목별 예산 대비 집행률 분석, 3)미수금·미지급금 확인, 4)잉여금 또는 부족액 산출, 5)외부 회계감사(의무관리 대상), 6)입주자대표회의 승인 후 입주민 공개. 결산서는 관리사무소와 K-apt에 공개됩니다.",
                "keywords": "결산,관리비,수입지출,예산,회계감사,잉여금,입주자대표회의",
            },
            {
                "category": "회계처리",
                "question": "관리비 예산 편성은 어떻게 하나요?",
                "answer": "관리비 예산은 매 회계연도 개시 1개월 전까지 편성합니다. 절차: 1)전년도 집행 실적 분석, 2)항목별 예산안 작성(인건비, 용역비, 수선비 등), 3)장기수선계획 반영, 4)입주자대표회의 심의·의결, 5)입주민 공개. 예산 대비 10% 이상 초과 집행 시 입주자대표회의 사전 승인이 필요합니다.",
                "keywords": "예산,편성,관리비,인건비,용역비,수선비,입주자대표회의",
            },
            {
                "category": "회계처리",
                "question": "관리비 영수증·증빙 관리는 어떻게 하나요?",
                "answer": "모든 관리비 지출에는 증빙서류(세금계산서, 계산서, 카드전표, 영수증 등)를 갖추어야 합니다. 증빙서류는 5년간 보관 의무가 있으며, 입주민이 열람을 요청할 수 있습니다. 전자 증빙 시스템을 활용하면 관리가 편리하고, 월별 지출 내역과 증빙을 대조하여 정확성을 확인합니다.",
                "keywords": "영수증,증빙,관리비,세금계산서,보관,열람,전자증빙",
            },
            # 기타 (Other) - 5 entries
            {
                "category": "기타",
                "question": "입주자대표회의란 무엇인가요?",
                "answer": "입주자대표회의는 공동주택(아파트)의 입주자를 대표하여 관리에 관한 주요 사항을 결정하는 자치기구입니다. 동별 대표자로 구성되며, 관리비 예산·결산 승인, 관리규약 제·개정, 관리업체 선정 등의 권한을 가집니다. 임기는 보통 2년이며, 선거를 통해 선출됩니다.",
                "keywords": "입주자대표회의,동별대표자,자치기구,관리규약,선거,임기",
            },
            {
                "category": "기타",
                "question": "관리규약이란 무엇인가요?",
                "answer": "관리규약은 공동주택 관리에 필요한 사항을 규정한 자치 규범입니다. 주요 내용: 관리비 부과·징수 기준, 공용부분 사용 규칙, 주차장 운영, 반려동물 규정, 층간소음 관련 규정, 하자보수 절차 등. 관리규약 제·개정은 입주자 과반수의 서면 동의가 필요합니다.",
                "keywords": "관리규약,공동주택,자치규범,주차,반려동물,층간소음,하자보수",
            },
            {
                "category": "기타",
                "question": "하자보수 청구는 어떻게 하나요?",
                "answer": "아파트 하자보수는 사용검사일로부터 하자담보책임기간(구조부 10년, 설비 2~5년, 마감 2~3년) 내에 시공사에 청구할 수 있습니다. 절차: 1)하자 발견 시 관리사무소에 신고, 2)하자보수 청구서 작성, 3)시공사 현장 확인, 4)보수 시행. 하자심사분쟁조정위원회(hajaday.or.kr)를 통해 분쟁 조정도 가능합니다.",
                "keywords": "하자보수,하자담보,시공사,하자보수청구,하자심사분쟁조정",
            },
            {
                "category": "기타",
                "question": "전입신고와 확정일자는 어떻게 받나요?",
                "answer": "전입신고는 이사 후 14일 이내에 주민센터(행정복지센터)에 신고하거나, 정부24(gov.kr)에서 온라인 신청 가능합니다. 확정일자는 전입신고 시 함께 신청하거나, 등기소·주민센터에서 임대차계약서에 날인을 받습니다. 비용 600원. 전입신고+확정일자를 갖추면 보증금 우선변제권을 확보할 수 있습니다.",
                "keywords": "전입신고,확정일자,주민센터,정부24,보증금,우선변제권",
            },
            {
                "category": "기타",
                "question": "관리사무소 업무 시간과 연락처를 알려주세요.",
                "answer": "관리사무소 운영 시간은 보통 평일 09:00~18:00(점심 12:00~13:00)이며, 단지별로 상이할 수 있습니다. 긴급 상황(누수, 승강기 고장 등)은 24시간 비상연락망을 통해 신고 가능합니다. 정확한 연락처와 운영 시간은 단지 게시판 또는 관리사무소에 문의해 주세요.",
                "keywords": "관리사무소,업무시간,연락처,비상연락망,긴급상황",
            },
        ]

        for entry in qa_entries:
            qa = QaKnowledge(company_id=1, **entry)
            db.add(qa)
        db.commit()

    # --- Seed QA for demo company (company_id=2) — same 25 entries ---
    if db.query(QaKnowledge).filter(QaKnowledge.company_id == 2).count() == 0:
        for entry in qa_entries:
            qa = QaKnowledge(company_id=2, **entry)
            db.add(qa)
        db.commit()
